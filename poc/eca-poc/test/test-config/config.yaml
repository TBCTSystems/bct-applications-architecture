# Test Configuration for Certificate Renewal Service
# This configuration is optimized for testing with shorter intervals and debug logging

# Service Settings
check_interval_minutes: 2  # Fast checking for testing (vs 30 minutes in production)
log_level: DEBUG
log_file: test/logs/cert_renewal_test.log
cert_storage_path: test/client-certs

# Renewal Threshold Settings (shorter for testing)
default_renewal_threshold_days: 5     # Short for testing (vs 30 in production)
emergency_renewal_threshold_days: 1   # Very short for testing (vs 7 in production)  
warning_threshold_days: 3             # Short for testing (vs 14 in production)

# Step CA Configuration
step_ca:
  protocol: "JWK"  # Use JWK protocol for Step CA native integration
  ca_url: "https://localhost:9000"
  ca_fingerprint: "35825219b2e3d85d046cb9b8e86408b66ae7ed15b23dcc9b5ab01dd85c31f57b"
  provisioner_name: "admin"
  provisioner_password: "testpassword"
  root_cert_path: "test/step-ca/certs/root_ca.crt"
  
  # Bootstrap settings for automatic CA trust
  bootstrap_ca: true
  
  # CRL settings
  crl_enabled: true
  crl_cache_dir: "test/client-certs/crl"
  crl_refresh_hours: 1  # Refresh CRL every hour for testing
  
  # Connection settings
  timeout_seconds: 30
  retry_attempts: 3
  retry_delay_seconds: 5

# Test Certificates to Monitor
# These correspond to the dummy certificates generated by generate_dummy_certs.py
certificates:
  - name: "test-web-server"
    cert_path: "test/dummy-certs/test-web-server.crt"
    key_path: "test/dummy-certs/test-web-server.key"
    renewal_threshold_days: 3  # Override default for this certificate
    subject: "test-web.local"
    sans:
      - "www.test-web.local"
      - "api.test-web.local"
    
  - name: "test-api-server"
    cert_path: "test/dummy-certs/test-api-server.crt"
    key_path: "test/dummy-certs/test-api-server.key"
    renewal_threshold_days: 5  # Use service default
    subject: "test-api.local"
    sans:
      - "api-v2.test-web.local"
      - "backend.test-web.local"
      
  - name: "test-expiring-soon"
    cert_path: "test/dummy-certs/test-expiring-soon.crt"
    key_path: "test/dummy-certs/test-expiring-soon.key"
    renewal_threshold_days: 2  # Emergency renewal scenario
    subject: "expiring.test.local"
    
  - name: "test-client-auth"
    cert_path: "test/dummy-certs/test-client-auth.crt"
    key_path: "test/dummy-certs/test-client-auth.key"
    renewal_threshold_days: 4
    subject: "client.test.local"
    sans:
      - "client-app.test.local"

# Alternative EST Protocol Configuration (commented out)
# Uncomment and modify to test EST protocol instead of JWK
# step_ca:
#   protocol: "EST"
#   ca_url: "https://localhost:8443/.well-known/est"
#   est_username: "testuser"
#   est_password: "testpass"
#   root_cert_path: "test/est-ca/certs/root_ca.crt"
#   
#   # EST-specific settings
#   est_additional_headers:
#     X-Test-Header: "testing"
#   
#   # CRL settings (same as JWK)
#   crl_enabled: true
#   crl_cache_dir: "test/client-certs/crl"
#   crl_refresh_hours: 1

# Notification Settings (for testing)
notifications:
  enabled: false  # Disable for testing
  # email:
  #   smtp_server: "localhost"
  #   smtp_port: 587
  #   from_address: "cert-renewal@test.local"
  #   to_addresses:
  #     - "admin@test.local"

# Health Check Settings
health_check:
  enabled: true
  port: 8080
  endpoint: "/health"

# Metrics Settings (optional)
metrics:
  enabled: false  # Disable for testing
  # prometheus:
  #   enabled: true
  #   port: 9090
  #   path: "/metrics"

# Testing-specific settings
testing:
  # Allow expired certificates for testing scenarios
  allow_expired_certificates: true
  
  # Skip actual renewal for dry-run testing
  dry_run_mode: false
  
  # Generate test reports
  generate_test_reports: true
  test_report_path: "test/logs/test_reports"