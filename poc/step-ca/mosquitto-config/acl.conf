# Mosquitto Access Control List (ACL) Configuration
# Topic-level permissions based on certificate identity

# =============================================================================
# Default Permissions
# =============================================================================

# Default: deny all access (explicit security)
# Users must be explicitly granted permissions

# =============================================================================
# Lumia Application Permissions
# =============================================================================

# Lumia application (CN=lumia-app)
user lumia-app
topic readwrite lumia/#
topic readwrite devices/+/status
topic readwrite devices/+/data
topic readwrite devices/+/commands/#
topic readwrite $SYS/broker/connection/+/state

# =============================================================================
# Device Permissions (Pattern-based)
# =============================================================================

# Reveos devices (CN=REVEOS-*)
pattern readwrite devices/%c/data
pattern readwrite devices/%c/status
pattern readwrite devices/%c/events
pattern read lumia/commands/%c
pattern read lumia/broadcast/+

# Generic device pattern (CN=device-*)
pattern readwrite devices/%c/data
pattern readwrite devices/%c/status
pattern read lumia/commands/%c

# =============================================================================
# Administrative Access
# =============================================================================

# Admin user (CN=admin)
user admin
topic readwrite #
topic readwrite $SYS/#

# =============================================================================
# System Topics
# =============================================================================

# Allow all authenticated users to read system status
topic read $SYS/broker/uptime
topic read $SYS/broker/version
topic read $SYS/broker/clients/connected
topic read $SYS/broker/clients/total

# =============================================================================
# Special Patterns
# =============================================================================

# Certificate-based topic access
# %c = certificate common name
# %u = username (same as CN when use_identity_as_username is true)

# Example: Device with CN=REVEOS-SIM-001 can access:
# - devices/REVEOS-SIM-001/data (readwrite)
# - devices/REVEOS-SIM-001/status (readwrite)
# - lumia/commands/REVEOS-SIM-001 (read)